{% extends 'layout.html' %}
{% block content %}
{% from 'macros.html' import render_pagination %}

<div class="pure-u-1">
	<table class="pure-table pure-table-horizontal">
		<thead>
			<tr align="center">
				<th>ID</th>
				<th>任务简述</th>
				<th>任务类型</th>
				<th>申请团队</th>
				<th>申请时间</th>
				<th>计划完成时间</th>
				<th>完成时间</th>
				<th>派单人</th>
				<th>执行人</th>
				<th>审核人</th>
				<th>状态</th>
				<th>功能 {% if current_user.is_authenticated() %}<a href="{{ url_for('task_add') }}"><i class="fa fa-plus-square-o"></i></a>{% endif %}</th>

			</tr>
		</thead>
		<tbody>
		{% for task in tasks %}
			<tr>
				<th>{{ task.id }}</th>
				<th align="left"><a href="{{ url_for('task_detail', id=task.id) }}">{{ task.title }}</a></th>

				{% if task.type == 1 %}<th>资源申请</th>{% endif %}
				{% if task.type == 2 %}<th>资源回收</th>{% endif %}
				{% if task.type == 3 %}<th>运维巡检</th>{% endif %}
				{% if task.type == 4 %}<th>故障处理&运维部署</th>{% endif %}

				<th>{{ task.team }}</th>
				<th>{{ task.created_time.strftime('%Y-%m-%d %H:%M:%S') }}</th>
				<th>{{ task.planned_time.strftime('%Y-%m-%d') }}</th>

				{% if task.executed_time %}<th>{{ task.executed_time.strftime('%Y-%m-%d %H:%M:%S') }}</th>
				{% else %}<th></th>
				{% endif %}

				{% if task.assigned_user %}<th align="left">{{ task.assigned_user }}</th>
				{% else %}<th></th>
				{% endif %}		

				{% if task.executed_user %}<th align="left">{{ task.executed_user }}</th>
				{% else %}<th></th>
				{% endif %}	
				
				{% if task.audited_user %}<th>{{ task.audited_user }}</th>
				{% else %}<th></th>
				{% endif %}
				
				{% if task.status == 1 %}
					<th style="color: gray">正在派单</th>
					<th>{% if current_user.is_authenticated() %}
						<a href="{{ url_for('task_assign', id=task.id) }}"><i class="fa fa-hand-o-right"></i></a>
						{% endif %}
					</th>
				{% endif %}
				
				{% if task.status == 2 %}
					<th style="color: green">正在执行</th>
					<th>{% if task.executed_user_id and current_user.id|string in ids[task.id] %}
						<a href="{{ url_for('task_execute', id=task.id) }}"><i class="fa fa-thumbs-o-up"></i></a>
						{% endif %}
					</th>					
				{% endif %}
				
				{% if task.status == 3 %}
					<th style="color: red">正在审核</th>
					<th>{% if current_user.team_id == 1 %}
						<a href="{{ url_for('task_audit', id=task.id) }}"><i class="fa fa-check-square-o"></i></a>
						{% endif %}
					</th>	
				{% endif %}
				
				{% if task.status == 4 %}<th>任务完成</th><th></th>{% endif %}
				{% if task.status == 5 %}<th>回收完成</th><th></th>{% endif %}
			</tr>
		{% endfor %}
		</tbody>
	</table>
</div>

{% if pagination.total > record_per_page %}
<div class="pure-u-1" style="padding-top:5px">
	{{ render_pagination(pagination, 'task_list') }}
</div>
{% endif %}

{% endblock %}